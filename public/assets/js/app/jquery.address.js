!function(a){a.address=function(){var b,c,d=function(b){var c=a.extend(a.Event(b),function(){for(var b={},c=a.address.parameterNames(),d=0,e=c.length;e>d;d++)b[c[d]]=a.address.parameter(c[d]);return{value:a.address.value(),path:a.address.path(),pathNames:a.address.pathNames(),parameterNames:c,parameters:b,queryString:a.address.queryString()}}.call(a.address));return a(a.address).trigger(c),c},e=function(a){return Array.prototype.slice.call(a)},f=function(){return a().bind.apply(a(a.address),Array.prototype.slice.call(arguments)),a.address},g=function(){return a().unbind.apply(a(a.address),Array.prototype.slice.call(arguments)),a.address},h=function(){return Q.pushState&&J.state!==b},i=function(){return("/"+R.pathname.replace(new RegExp(J.state),"")+R.search+(j()?"#"+j():"")).replace(U,"/")},j=function(){var a=R.href.indexOf("#");return-1!=a?R.href.substr(a+1):""},k=function(){return h()?i():j()},l=function(){try{return top.document!==b&&top.document.title!==b&&top.jQuery!==b&&top.jQuery.address!==b&&top.jQuery.address.frames()!==!1?top:window}catch(a){return window}},m=function(){return"javascript"},n=function(a){return a=a.toString(),(J.strict&&"/"!=a.substr(0,1)?"/":"")+a},o=function(a,b){return parseInt(a.css(b),10)},p=function(){if(!$){var a=k(),b=decodeURI(cb)!=decodeURI(a);b&&(N&&7>L?R.reload():(N&&!W&&J.history&&T(s,50),cb=a,q(I)))}},q=function(a){return T(r,10),d(E).isDefaultPrevented()||d(a?F:G).isDefaultPrevented()},r=function(){if("null"!==J.tracker&&J.tracker!==z){var c=a.isFunction(J.tracker)?J.tracker:O[J.tracker],d=(R.pathname+R.search+(a.address&&!h()?a.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");a.isFunction(c)?c(d):a.isFunction(O.urchinTracker)?O.urchinTracker(d):O.pageTracker!==b&&a.isFunction(O.pageTracker._trackPageview)?O.pageTracker._trackPageview(d):O._gaq!==b&&a.isFunction(O._gaq.push)&&O._gaq.push(["_trackPageview",decodeURI(d)])}},s=function(){var a=m()+":"+I+";document.open();document.writeln('<html><head><title>"+P.title.replace(/\'/g,"\\'")+"</title><script>var "+A+' = "'+encodeURIComponent(k()).replace(/\'/g,"\\'")+(P.domain!=R.hostname?'";document.domain="'+P.domain:"")+"\";</script></head></html>');document.close();";7>L?c.src=a:c.contentWindow.location.replace(a)},t=function(){if(X&&-1!=Y){var a,b,c=X.substr(Y+1).split("&");for(a=0;a<c.length;a++)b=c[a].split("="),/^(autoUpdate|history|strict|wrap)$/.test(b[0])&&(J[b[0]]=isNaN(b[1])?/^(true|yes)$/i.test(b[1]):0!==parseInt(b[1],10)),/^(state|tracker)$/.test(b[0])&&(J[b[0]]=b[1]);X=z}cb=k()},u=function(){if(!_){if(_=H,t(),a('a[rel*="address:"]').address(),J.wrap){{var e=a("body");a("body > *").wrapAll('<div style="padding:'+(o(e,"marginTop")+o(e,"paddingTop"))+"px "+(o(e,"marginRight")+o(e,"paddingRight"))+"px "+(o(e,"marginBottom")+o(e,"paddingBottom"))+"px "+(o(e,"marginLeft")+o(e,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+A+'" style="height:100%;overflow:auto;position:relative;'+(M&&!window.statusbar.visible?"resize:both;":"")+'" />')}a("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),M&&a('<style type="text/css" />').appendTo("head").text("#"+A+"::-webkit-resizer { background-color: #fff; }")}if(N&&!W){var f=P.getElementsByTagName("frameset")[0];c=P.createElement((f?"":"i")+"frame"),c.src=m()+":"+I,f?(f.insertAdjacentElement("beforeEnd",c),f[f.cols?"cols":"rows"]+=",0",c.noResize=H,c.frameBorder=c.frameSpacing=0):(c.style.display="none",c.style.width=c.style.height=0,c.tabIndex=-1,P.body.insertAdjacentElement("afterBegin",c)),T(function(){a(c).bind("load",function(){var a=c.contentWindow;cb=a[A]!==b?a[A]:"",cb!=k()&&(q(I),R.hash=cb)}),c.contentWindow[A]===b&&s()},50)}T(function(){d("init"),q(I)},1),h()||(N&&L>7||!N&&W?O.addEventListener?O.addEventListener(C,p,I):O.attachEvent&&O.attachEvent("on"+C,p):S(p,50)),"state"in window.history&&a(window).trigger("popstate")}},v=function(){decodeURI(cb)!=decodeURI(k())&&(cb=k(),q(I))},w=function(){O.removeEventListener?O.removeEventListener(C,p,I):O.detachEvent&&O.detachEvent("on"+C,p)},x=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},y=function(){var a={},b=x(navigator.userAgent);return b.browser&&(a[b.browser]=!0,a.version=b.version),a.chrome?a.webkit=!0:a.webkit&&(a.safari=!0),a},z=null,A="jQueryAddress",B="string",C="hashchange",D="init",E="change",F="internalChange",G="externalChange",H=!0,I=!1,J={autoUpdate:H,history:H,strict:H,frames:H,wrap:I},K=y(),L=parseFloat(K.version),M=K.webkit||K.safari,N=!a.support.opacity,O=l(),P=O.document,Q=O.history,R=O.location,S=setInterval,T=setTimeout,U=/\/{2,9}/g,V=navigator.userAgent,W="on"+C in O,X=a("script:last").attr("src"),Y=X?X.indexOf("?"):-1,Z=P.title,$=I,_=I,ab=H,bb=I,cb=k();if(N){L=parseFloat(V.substr(V.indexOf("MSIE")+4)),P.documentMode&&P.documentMode!=L&&(L=8!=P.documentMode?7:8);var db=P.onpropertychange;P.onpropertychange=function(){db&&db.call(P),P.title!=Z&&-1!=P.title.indexOf("#"+k())&&(P.title=Z)}}if(Q.navigationMode&&(Q.navigationMode="compatible"),"complete"==document.readyState)var eb=setInterval(function(){a.address&&(u(),clearInterval(eb))},50);else t(),a(u);return a(window).bind("popstate",v).bind("unload",w),{bind:function(){return f.apply(this,e(arguments))},unbind:function(){return g.apply(this,e(arguments))},init:function(){return f.apply(this,[D].concat(e(arguments)))},change:function(){return f.apply(this,[E].concat(e(arguments)))},internalChange:function(){return f.apply(this,[F].concat(e(arguments)))},externalChange:function(){return f.apply(this,[G].concat(e(arguments)))},baseURL:function(){var a=R.href;return-1!=a.indexOf("#")&&(a=a.substr(0,a.indexOf("#"))),/\/$/.test(a)&&(a=a.substr(0,a.length-1)),a},autoUpdate:function(a){return a!==b?(J.autoUpdate=a,this):J.autoUpdate},history:function(a){return a!==b?(J.history=a,this):J.history},state:function(a){if(a!==b){J.state=a;var c=i();return J.state!==b&&(Q.pushState?"/#/"==c.substr(0,3)&&R.replace(J.state.replace(/^\/$/,"")+c.substr(2)):"/"!=c&&c.replace(/^\/#/,"")!=j()&&T(function(){R.replace(J.state.replace(/^\/$/,"")+"/#"+c)},1)),this}return J.state},frames:function(a){return a!==b?(J.frames=a,O=l(),this):J.frames},strict:function(a){return a!==b?(J.strict=a,this):J.strict},tracker:function(a){return a!==b?(J.tracker=a,this):J.tracker},wrap:function(a){return a!==b?(J.wrap=a,this):J.wrap},update:function(){return bb=H,this.value(cb),bb=I,this},title:function(a){return a!==b?(T(function(){Z=P.title=a,ab&&c&&c.contentWindow&&c.contentWindow.document&&(c.contentWindow.document.title=a,ab=I)},50),this):P.title},value:function(a){if(a!==b){if(a=n(a),"/"==a&&(a=""),cb==a&&!bb)return;if(cb=a,J.autoUpdate||bb){if(q(H))return this;h()?Q[J.history?"pushState":"replaceState"]({},"",J.state.replace(/\/$/,"")+(""===cb?"/":cb)):($=H,M?J.history?R.hash="#"+cb:R.replace("#"+cb):cb!=k()&&(J.history?R.hash="#"+cb:R.replace("#"+cb)),N&&!W&&J.history&&T(s,50),M?T(function(){$=I},1):$=I)}return this}return n(cb)},path:function(a){if(a!==b){var c=this.queryString(),d=this.hash();return this.value(a+(c?"?"+c:"")+(d?"#"+d:"")),this}return n(cb).split("#")[0].split("?")[0]},pathNames:function(){var a=this.path(),b=a.replace(U,"/").split("/");return("/"==a.substr(0,1)||0===a.length)&&b.splice(0,1),"/"==a.substr(a.length-1,1)&&b.splice(b.length-1,1),b},queryString:function(a){if(a!==b){var c=this.hash();return this.value(this.path()+(a?"?"+a:"")+(c?"#"+c:"")),this}var d=cb.split("?");return d.slice(1,d.length).join("?").split("#")[0]},parameter:function(c,d,e){var f,g;if(d!==b){var h=this.parameterNames();for(g=[],d=d===b||d===z?"":d.toString(),f=0;f<h.length;f++){var i=h[f],j=this.parameter(i);typeof j==B&&(j=[j]),i==c&&(j=d===z||""===d?[]:e?j.concat([d]):[d]);for(var k=0;k<j.length;k++)g.push(i+"="+j[k])}return-1==a.inArray(c,h)&&d!==z&&""!==d&&g.push(c+"="+d),this.queryString(g.join("&")),this}if(d=this.queryString()){var l=[];for(g=d.split("&"),f=0;f<g.length;f++){var m=g[f].split("=");m[0]==c&&l.push(m.slice(1).join("="))}if(0!==l.length)return 1!=l.length?l:l[0]}},parameterNames:function(){var b=this.queryString(),c=[];if(b&&-1!=b.indexOf("="))for(var d=b.split("&"),e=0;e<d.length;e++){var f=d[e].split("=")[0];-1==a.inArray(f,c)&&c.push(f)}return c},hash:function(a){if(a!==b)return this.value(cb.split("#")[0]+(a?"#"+a:"")),this;var c=cb.split("#");return c.slice(1,c.length).join("#")}}}(),a.fn.address=function(b){return a(this).each(function(){a(this).data("address")||a(this).on("click",function(c){if(c.shiftKey||c.ctrlKey||c.metaKey||2==c.which)return!0;var d=c.currentTarget;if(a(d).is("a")){c.preventDefault();var e=b?b.call(d):/address:/.test(a(d).attr("rel"))?a(d).attr("rel").split("address:")[1].split(" ")[0]:void 0===a.address.state()||/^\/?$/.test(a.address.state())?a(d).attr("href").replace(/^(#\!?|\.)/,""):a(d).attr("href").replace(new RegExp("^(.*"+a.address.state()+"|\\.)"),"");a.address.value(e)}}).on("submit",function(c){var d=c.currentTarget;if(a(d).is("form")){c.preventDefault();var e=a(d).attr("action"),f=b?b.call(d):(-1!=e.indexOf("?")?e.replace(/&$/,""):e+"?")+a(d).serialize();a.address.value(f)}}).data("address",!0)}),this}}(jQuery);