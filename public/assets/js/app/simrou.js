(function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,e=[].slice;b=function(){function b(a){this.handleFormSubmit=c(this.handleFormSubmit,this),this.resolveHash=c(this.resolveHash,this),this.routes={},this.listening=!1,this.observeHash=!1,this.observeForms=!1,null!=a&&this.addRoutes(a)}return b.prototype.RegExpCache={extractHash:/^[^#]*(#.*)$/,trimHash:/^#*(.*?)\/*$/},b.prototype.eventSupported=function(){var a;return a=window.document.documentMode,"onhashchange"in window&&(!(null!=a)||a>7)}(),b.prototype.addRoute=function(b,c){var d;return null==c&&(c=!0),d=b instanceof a?b:new a(b,c),this.routes[d.toString()]=d},b.prototype.addRoutes=function(a,b){var c,e,f,g,h,i;if(null==b&&(b=!0),jQuery.isFunction(a))e=a.call(this,b);else if(jQuery.isArray(a))for(e=[],h=0,i=a.length;i>h;h++)g=a[h],e.push(this.addRoutes(g,b));else if(jQuery.isPlainObject(a)){e={};for(f in a)d.call(a,f)&&(c=a[f],g=this.addRoute(f,b),g.attachActions(c),e[f]=g)}else e=this.addRoute(a,b);return e},b.prototype.removeRoute=function(b){var c;return b instanceof a||(b=new a(b)),c=b.toString(),c in this.routes?delete this.routes[c]:void 0},b.prototype.navigate=function(a){var b;return b=this.getHash(),location.hash=a,this.observeHash&&location.hash!==b?void 0:this.resolve(a,"get")},b.prototype.resolve=function(b,c){var e,f,g,h,i,j,k;if(g=String(b).replace(this.RegExpCache.trimHash,"$1"),""===g){if(-1===String(b).indexOf("/"))return!1;g="/"}k=this.routes;for(h in k)if(d.call(k,h)&&(j=k[h],j instanceof a&&(i=j.match(g))))return f=[i,c],e=jQuery(j),e.trigger("simrou:any",f),null!=c&&"any"!==c&&e.trigger("simrou:"+c.toLowerCase(),f),!0;return!1},b.prototype.getHash=function(a){return null==a&&(a=location.hash),String(a).replace(this.RegExpCache.extractHash,"$1")},b.prototype.resolveHash=function(a){var b,c;return this.observeHash?(this.eventSupported&&(c=a.originalEvent.newURL),b=this.getHash(c),this.resolve(b,"get")):void 0},b.prototype.handleFormSubmit=function(a){var b,c,d;return this.observeForms&&(b=jQuery(a.target),d=b.attr("method")||b.get(0).getAttribute("method"),c=this.getHash(b.attr("action")),this.resolve(c,d)&&a.preventDefault()),!0},b.prototype.listen=function(){var a=this;return this.listening?void 0:(jQuery(window).on("hashchange.simrou",this.resolveHash),jQuery(function(){return jQuery("body").on("submit.simrou","form",a.handleFormSubmit)}),this.listening=!0)},b.prototype.start=function(a,b,c){var d;return this.observeHash=null!=b?b:!0,this.observeForms=null!=c?c:!0,(this.observeHash||this.observeForms)&&this.listen(),d=this.getHash(),""!==d?this.resolve(d,"get"):null!=a?null!=window.history&&null!=window.history.replaceState?(window.history.replaceState({},document.title,"#"+a.replace(/^#+/,"")),this.resolve(a,"get")):this.navigate(a):void 0},b.prototype.stop=function(){return this.observeHash=!1,this.observeForms=!1},b}(),a=function(){function a(a,b){var c,d,e;this.pattern=a,this.caseSensitive=null!=b?b:!0,a=String(this.pattern),e=a.match(this.RegExpCache.allParams),this.params=null!=e?function(){var a,b,c;for(c=[],a=0,b=e.length;b>a;a++)d=e[a],c.push(d.substr(1));return c}():[],a=a.replace(this.RegExpCache.escapeRegExp,"\\$&"),a=a.replace(this.RegExpCache.namedParam,"([^/]+)"),a=a.replace(this.RegExpCache.splatParam,"(.*?)"),c=b?"":"i",this.expr=new RegExp("^"+a+"$",c)}var b;return a.prototype.RegExpCache={escapeRegExp:/[-[\]{}()+?.,\\^$|#\s]/g,namedParam:/:(\w+)/g,splatParam:/\*(\w+)/g,firstParam:/(:\w+)|(\*\w+)/,allParams:/(:|\*)\w+/g},a.prototype.match=function(a){var b,c,d,e,f,g,h;if(c=this.expr.exec(a),jQuery.isArray(c))for(e={},h=this.params,b=f=0,g=h.length;g>f;b=++f)d=h[b],e[d]=c[b+1];else e=!1;return e},a.prototype.assemble=function(){var a,b,c,d;d=1<=arguments.length?e.call(arguments,0):[],d.length>0&&(jQuery.isArray(d[0])?d=d[0]:jQuery.isPlainObject(d[0])&&(d=function(){var b,c,e,f;for(e=this.params,f=[],b=0,c=e.length;c>b;b++)a=e[b],f.push(a in d[0]?d[0][a]:"");return f}.call(this))),b=String(this.pattern);for(;this.RegExpCache.firstParam.test(b);)c=d.length>0?d.shift():"",jQuery.isFunction(c)&&(c=c(this)),b=b.replace(this.RegExpCache.firstParam,String(c));return b},a.prototype.toString=function(){return String(this.pattern)},a.prototype.attachAction=function(a,b){return null==b&&(b="any"),jQuery(this).on("simrou:"+b.toLowerCase(),a)},a.prototype.attachActions=function(a,b){var c,e,f,g,h;null==b&&(b="any"),jQuery.isPlainObject(a)||(g=[{},a],a=g[0],f=g[1],a[b]=f),h=[];for(b in a)d.call(a,b)&&(e=a[b],jQuery.isArray(e)||(e=[e]),h.push(function(){var a,d,f;for(f=[],a=0,d=e.length;d>a;a++)c=e[a],f.push(this.attachAction(c,b));return f}.call(this)));return h},a.prototype.detachAction=function(a,b){var c;return null==b&&(b="any"),"string"==typeof a&&(b=a),c="simrou:"+b.toLowerCase(),jQuery.isFunction(a)?jQuery(this).off(c,a):jQuery(this).off(c)},b=function(a){return function(b){return this.attachAction(b,a)}},a.prototype.get=b("get"),a.prototype.post=b("post"),a.prototype.put=b("put"),a.prototype["delete"]=b("delete"),a.prototype.any=b("any"),a}(),b.Route=a,window.Simrou=jQuery.Simrou=b}).call(this);